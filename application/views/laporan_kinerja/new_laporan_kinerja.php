<!-- Content Wrapper. Contains page content -->
<style>
    div.dt-top-container {
        display: grid;
        grid-template-columns: auto auto auto;
    }

    div.dt-center-in-div {
        margin: 0 auto;
    }

    div.dt-filter-spacer {
        margin: 10px 0;
    }
</style>
<div class="main-content">
    <section class="section">
    <nav class="navbar navbar-expand-lg main-navbar" style="background-color:#fce49c;height:50px;
  position: fixed; top:50px;  padding-bottom: -10px;">
            <b style="margin-left: auto; font-weight:1000" class="text-black">Modul 4 : ANALISIS DATA</b>
        </nav>

        <div class="card" style="margin-top: 20px; padding: 20px;background: rgb(36,93,120);
background: linear-gradient(188deg, rgba(36,93,120,1) 47%, rgba(1,118,205,1) 92%); color:white">
            <h4 style="font-family: 'Poppins', sans-serif;"><b> MODUL 4 - ANALISIS DATA </b></h4>
            <h6 style="font-family: 'Poppins', sans-serif;">Modul ini digunakan dalam membuat Data Terkait Informasi Laporan Kinerja yang sudah ada</h6>

        </div>
        <div class="content-wrapper" style="background-color:white">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row mb-2">
                    </div><!-- /.row -->
                </div><!-- /.container-fluid -->
            </div>
            <!-- /.content-header -->

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-sm-12">
                                <div class="card card-outline card-warning">
                                    <div class="card-header">
                                        <h6> <i class="fa fa-book"></i> LAPORAN REALISASI KERJA DAN BIAYA PROGRAM </h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="card card-outline card-primary">
                                            <div class="card-header">
                                                <center>
                                                    <?= $row_kontrak['nama_kontrak'] ?>
                                                </center>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="card card-outline card-primary">
                                            <!-- /.card-header -->
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="card card-primary card-tabs">
                                                        <div class="card-header p-0 pt-1">
                                                            <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                                                                <li class="nav-item">
                                                                    <a class="nav-link active" id="custom-tabs-two-home-tab" data-toggle="pill" href="#custom-tabs-two-home" role="tab" aria-controls="custom-tabs-two-home" aria-selected="true"><i class="fa fa-filter" aria-hidden="true"></i> View Laporan</a>
                                                                </li>
                                                                <li class="nav-item">
                                                                    <a class="nav-link" id="custom-tabs-two-januari-tab" data-toggle="pill" href="#custom-tabs-two-januari" role="tab" aria-controls="custom-tabs-two-januari" aria-selected="false"><i class="fa fa-calendar" aria-hidden="true"></i> View Action</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content" id="custom-tabs-two-tabContent">
                                                                <!-- LAPORAN KINERJA VIEW -->
                                                                <div class="tab-pane fade show active" id="custom-tabs-two-home" role="tabpanel" aria-labelledby="custom-tabs-two-home-tab">
                                                                    <div class="card card-outline card-primary">
                                                                        <div class="card-header">
                                                                            <h3 class="card-title">
                                                                                View Laporan Kinerja
                                                                            </h3>
                                                                        </div>
                                                                        <br>
                                                                        <div style="overflow-x: auto;">
                                                                            <div class="card-body">
                                                                                <style type="text/css">
                                                                                    .tg {
                                                                                        border-collapse: collapse;
                                                                                        border-spacing: 0;
                                                                                    }

                                                                                    .tg td {
                                                                                        border-color: black;
                                                                                        border-style: solid;
                                                                                        border-width: 1px;
                                                                                       font-family: RNSSanz-Black;
                                                                                       text-transform: uppercase;
                                                                                        font-size: 14px;
                                                                                        overflow: hidden;
                                                                                        padding: 10px 5px;
                                                                                        word-break: normal;
                                                                                    }

                                                                                    .tg th {
                                                                                        color: white !important;
                                                                                        border-color: black;
                                                                                        border-style: solid;
                                                                                        border-width: 1px;
                                                                                       font-family: RNSSanz-Black;
                                                                                       text-transform: uppercase;
                                                                                        font-size: 14px;
                                                                                        font-weight: normal;
                                                                                        overflow: hidden;
                                                                                        padding: 10px 5px;
                                                                                        word-break: normal;
                                                                                        background-color: #193B53 !important;
                                                                                    }

                                                                                    .tg .tg-baqh {
                                                                                        text-align: center;
                                                                                        vertical-align: top
                                                                                    }

                                                                                    .tg .tg-0lax {
                                                                                        text-align: left;
                                                                                        vertical-align: top
                                                                                    }

                                                                                    .div1 {
                                                                                        border: 1px solid #777777;
                                                                                    }

                                                                                    .div1 table {
                                                                                        border-spacing: 0;
                                                                                    }

                                                                                    .div1 th {
                                                                                        border-left: none;
                                                                                        border-right: 1px solid #bbbbbb;
                                                                                        padding: 5px;
                                                                                        width: 80px;
                                                                                        min-width: 80px;
                                                                                        position: sticky;
                                                                                        top: 0;
                                                                                        color: #e0e0e0;
                                                                                        font-weight: normal;
                                                                                    }

                                                                                    .div1 tr {
                                                                                        color: black;
                                                                                        ;
                                                                                    }

                                                                                    .div1 td {
                                                                                        border-left: none;
                                                                                        border-right: 1px solid #bbbbbb;
                                                                                        border-bottom: 1px solid #bbbbbb;
                                                                                        padding: 5px;
                                                                                        width: 80px;
                                                                                        min-width: 80px;
                                                                                    }

                                                                                    .div1 th:nth-child(1),
                                                                                    .div1 td:nth-child(1) {
                                                                                        position: sticky;
                                                                                        left: 0;
                                                                                        width: 150px;
                                                                                        min-width: 150px;
                                                                                    }

                                                                                    .div1 th:nth-child(2),
                                                                                    .div1 td:nth-child(2) {
                                                                                        position: sticky;
                                                                                        left: 150px;
                                                                                        width: 50px;
                                                                                        min-width: 50px;
                                                                                    }

                                                                                    .div1 td:nth-child(1),
                                                                                    .div1 td:nth-child(2) {
                                                                                        background-color: #F0F8FF;
                                                                                    }

                                                                                    .div1 th:nth-child(1),
                                                                                    .div1 th:nth-child(2) {
                                                                                        z-index: 2;
                                                                                    }
                                                                                </style>
                                                                                <table class="table tg mt-3 div1">
                                                                                    <colgroup>
                                                                                        <col style="width: 32px">
                                                                                        <col style="width: 64px">
                                                                                        <col style="width: 138px">
                                                                                        <col style="width: 245px">
                                                                                        <col style="width: 200px">
                                                                                        <col style="width: 246px">
                                                                                        <col style="width: 208px">
                                                                                        <col style="width: 238px">
                                                                                    </colgroup>
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th class="tg-baqh" rowspan="2">NO</th>
                                                                                            <th class="tg-baqh" rowspan="2">URAIAN</th>
                                                                                            <th class="tg-baqh" rowspan="2">NAMA PEKERJAAN</th>
                                                                                            <th class="tg-baqh">PENDAPATAN KONTRAK MANAJEMEN</th>
                                                                                            <th class="tg-baqh" colspan="4">DATA PENYEDIA</th>
                                                                                            <th class="tg-baqh" rowspan="2">HPS</th>
                                                                                            <th class="tg-baqh" rowspan="2">KONTRAK AWAL VENDOR</th>
                                                                                            <th class="tg-baqh" rowspan="2">NILAI ADDENDUM FINAL QUANTITY VENDOR</th>
                                                                                            <th class="tg-baqh" rowspan="2">PROGNOSA BEBAN</th>
                                                                                            <th class="tg-baqh" rowspan="2">PROGRES FISIK</th>
                                                                                            <th class="tg-baqh" rowspan="2">REALISASI PENDAPATAN SESUAI PROGRES FISIK</th>
                                                                                            <th class="tg-baqh" rowspan="2">REALISASI BEBAN SESUAI PROGRES FISIK</th>
                                                                                            <th class="tg-baqh" rowspan="2">EFISIENSI TOTAL (Rp)</th>
                                                                                            <th class="tg-baqh" rowspan="2">MARGIN (%)</th>
                                                                                            <th class="tg-baqh" rowspan="2">FEE JMTM (Rp)</th>
                                                                                            <th class="tg-baqh" rowspan="2">DIKEMBALIKAN KE OWNER (Rp)</th>
                                                                                            <th class="tg-baqh" rowspan="2">PROGNOSA BEBAN AKHIR TAHUN</th>
                                                                                            <th class="tg-baqh" rowspan="2">KETERANGAN</th>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <th class="tg-baqh">KONTRAK AWAL/ ADD</th>
                                                                                            <th class="tg-baqh">Nama Penyedia</th>
                                                                                            <th class="tg-baqh">Nomor Kontrak Penyedia</th>
                                                                                            <th class="tg-0lax">Tanggal Kontrak Penyedia</th>
                                                                                            <th class="tg-0lax">Nilai Kontrak Penyedia Terupdate</th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody>
                                                                                        <?php
                                                                                        // capex
                                                                                        $this->db->select('*');
                                                                                        $this->db->from('tbl_capex');
                                                                                        $this->db->where('tbl_capex.id_kontrak', $row_kontrak['id_kontrak']);
                                                                                        $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                        $query_result_capex = $this->db->get() ?>
                                                                                        <?php
                                                                                        foreach ($query_result_capex->result_array() as $value_capex) { ?>
                                                                                            <?php $id_capex = $value_capex['id_capex'];   ?>
                                                                                            <?php $nama_uraian_capex = $value_capex['nama_uraian']; ?>
                                                                                            <tr>
                                                                                                <td class="tg-0lax"><?= $value_capex['no_urut'] ?></td>
                                                                                                <td class="tg-0lax"><?= $value_capex['nama_uraian']; ?></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                            </tr>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex);
                                                                                            if ($id_departemen == 4) {
                                                                                            } else {
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                            }
                                                                                            $result_program = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                // 
                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                }

                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                }
                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                    <?php
                                                                                                    // capex
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->limit(1);
                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                    <?php   } else { ?>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php   }  ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                    <?php   }
                                                                                                    ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                </tr>
                                                                                            <?php } ?>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_capex_detail');
                                                                                            $this->db->where('tbl_capex_detail.id_capex', $id_capex);
                                                                                            $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                            $query_result_capex_detail = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($query_result_capex_detail->result_array() as $value_capex_detail) { ?>
                                                                                                <?php $id_capex_detail = $value_capex_detail['id_capex_detail'];  ?>
                                                                                                <?php $nama_uraian_capex_detail = $value_capex_detail['nama_uraian']; ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"><?= $value_capex_detail['no_urut'] ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_capex_detail['nama_uraian']; ?></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                </tr>
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail);
                                                                                                if ($id_departemen == 4) {
                                                                                                } else {
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                }
                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                $result_program = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    // 
                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                    }

                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                    }
                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                    $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                    ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                        <?php
                                                                                                        // capex
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->limit(1);
                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                        <?php   } else { ?>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php   }  ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                        <?php   }
                                                                                                        ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                    </tr>
                                                                                                <?php } ?>
                                                                                                <!-- _1_ -->
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_detail_capex_1');
                                                                                                $this->db->where('tbl_detail_capex_1.id_capex_detail', $id_capex_detail);
                                                                                                $this->db->order_by('CAST(no_urut_1_capex AS DECIMAL(10,6)) ASC');
                                                                                                $query_result_capex_detail_1 = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($query_result_capex_detail_1->result_array() as $value_capex_detail_1) { ?>
                                                                                                    <?php $id_detail_capex_1 = $value_capex_detail_1['id_detail_capex_1'];  ?>
                                                                                                    <?php $nama_uraian_capex_detail_1 = $value_capex_detail_1['nama_uraian_1_capex']; ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_1['no_urut_1_capex'] ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_1['nama_uraian_1_capex']; ?></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    </tr>
                                                                                                    <?php
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_1);
                                                                                                    if ($id_departemen == 4) {
                                                                                                    } else {
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                    }
                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                    $result_program = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        // 
                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                        }

                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                        }
                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                        $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                        ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                            <?php
                                                                                                            // capex
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->limit(1);
                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                            <?php   } else { ?>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php   }  ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                            <?php   }
                                                                                                            ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                        </tr>
                                                                                                    <?php } ?>
                                                                                                    <?php
                                                                                                    // _1
                                                                                                    // _2
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_detail_capex_2');
                                                                                                    $this->db->where('tbl_detail_capex_2.id_detail_capex_1', $id_detail_capex_1);
                                                                                                    $this->db->order_by('CAST(no_urut_2_capex AS DECIMAL(10,6)) ASC');
                                                                                                    $query_result_capex_detail_2 = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($query_result_capex_detail_2->result_array() as $value_capex_detail_2) { ?>
                                                                                                        <?php $id_detail_capex_2 = $value_capex_detail_2['id_detail_capex_2'];  ?>
                                                                                                        <?php $nama_uraian_capex_detail_2 = $value_capex_detail_2['nama_uraian_2_capex']; ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_2['no_urut_2_capex'] ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_2['nama_uraian_2_capex']; ?></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        </tr>
                                                                                                        <?php
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_2);
                                                                                                        if ($id_departemen == 4) {
                                                                                                        } else {
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                        }
                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                        $result_program = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            // 
                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                            }

                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                            }
                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                            $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                            ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                <?php
                                                                                                                // capex
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->limit(1);
                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                <?php   } else { ?>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php   }  ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                <?php   }
                                                                                                                ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                            </tr>
                                                                                                        <?php } ?>
                                                                                                        <?php
                                                                                                        // _2
                                                                                                        // _3
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_detail_capex_3');
                                                                                                        $this->db->where('tbl_detail_capex_3.id_detail_capex_2', $id_detail_capex_2);
                                                                                                        $this->db->order_by('CAST(no_urut_3_capex AS DECIMAL(10,6)) ASC');
                                                                                                        $query_result_capex_detail_3 = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($query_result_capex_detail_3->result_array() as $value_capex_detail_3) { ?>
                                                                                                            <?php $id_detail_capex_3 = $value_capex_detail_3['id_detail_capex_3'];  ?>
                                                                                                            <?php $nama_uraian_capex_detail_3 = $value_capex_detail_3['nama_uraian_3_capex']; ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_3['no_urut_3_capex'] ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_3['nama_uraian_3_capex']; ?></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            </tr>
                                                                                                            <?php
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_3);
                                                                                                            if ($id_departemen == 4) {
                                                                                                            } else {
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                            }
                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                            $result_program = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                // 
                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                }

                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                }
                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                    <?php
                                                                                                                    // capex
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->limit(1);
                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                    <?php   } else { ?>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php   }  ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                    <?php   }
                                                                                                                    ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                </tr>
                                                                                                            <?php } ?>

                                                                                                            <?php
                                                                                                            // _3
                                                                                                            // _4
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_detail_capex_4');
                                                                                                            $this->db->where('tbl_detail_capex_4.id_detail_capex_3', $id_detail_capex_3);
                                                                                                            $this->db->order_by('CAST(no_urut_4_capex AS DECIMAL(10,6)) ASC');
                                                                                                            $query_result_capex_detail_4 = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($query_result_capex_detail_4->result_array() as $value_capex_detail_4) { ?>
                                                                                                                <?php $id_detail_capex_4 = $value_capex_detail_4['id_detail_capex_4'];  ?>
                                                                                                                <?php $nama_uraian_capex_detail_4 = $value_capex_detail_4['nama_uraian_4_capex']; ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"><?= $value_capex_detail_4['no_urut_4_capex'] ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_capex_detail_4['nama_uraian_4_capex']; ?></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                </tr>
                                                                                                                <?php
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_4);
                                                                                                                if ($id_departemen == 4) {
                                                                                                                } else {
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                }
                                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                $result_program = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    // 
                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                    }

                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                    }
                                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                    $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                    ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                                        <?php
                                                                                                                        // capex
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->limit(1);
                                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                        <?php   } else { ?>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php   }  ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                        <?php   }
                                                                                                                        ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                    </tr>
                                                                                                                <?php } ?>

                                                                                                                <?php
                                                                                                                // _4
                                                                                                                // _5
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_detail_capex_5');
                                                                                                                $this->db->where('tbl_detail_capex_5.id_detail_capex_4', $id_detail_capex_4);
                                                                                                                $this->db->order_by('CAST(no_urut_5_capex AS DECIMAL(10,6)) ASC');
                                                                                                                $query_result_capex_detail_5 = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($query_result_capex_detail_5->result_array() as $value_capex_detail_5) { ?>
                                                                                                                    <?php $id_detail_capex_5 = $value_capex_detail_5['id_detail_capex_5'];  ?>
                                                                                                                    <?php $nama_uraian_capex_detail_5 = $value_capex_detail_5['nama_uraian_5_capex']; ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_5['no_urut_5_capex'] ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_5['nama_uraian_5_capex']; ?></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    </tr>
                                                                                                                    <?php
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_5);
                                                                                                                    if ($id_departemen == 4) {
                                                                                                                    } else {
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                    }
                                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                    $result_program = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        // 
                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                        }

                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                        }
                                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                        $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                        ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                                            <?php
                                                                                                                            // capex
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->limit(1);
                                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                            <?php   } else { ?>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php   }  ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                            <?php   }
                                                                                                                            ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                        </tr>
                                                                                                                    <?php } ?>
                                                                                                                    <?php
                                                                                                                    // _5
                                                                                                                    // _6
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_detail_capex_6');
                                                                                                                    $this->db->where('tbl_detail_capex_6.id_detail_capex_5', $id_detail_capex_5);
                                                                                                                    $this->db->order_by('CAST(no_urut_6_capex AS DECIMAL(10,6)) ASC');
                                                                                                                    $query_result_capex_detail_6 = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($query_result_capex_detail_6->result_array() as $value_capex_detail_6) { ?>
                                                                                                                        <?php $id_detail_capex_6 = $value_capex_detail_6['id_detail_capex_6'];  ?>
                                                                                                                        <?php $nama_uraian_capex_detail_6 = $value_capex_detail_6['nama_uraian_6_capex']; ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_6['no_urut_6_capex'] ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_6['nama_uraian_6_capex']; ?></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        </tr>
                                                                                                                        <?php
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_6);
                                                                                                                        if ($id_departemen == 4) {
                                                                                                                        } else {
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                        }
                                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                        $result_program = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            // 
                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                            }

                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                            }
                                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                            $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                            ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                                <?php
                                                                                                                                // capex
                                                                                                                                $this->db->select('*');
                                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                $this->db->limit(1);
                                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                <?php   } else { ?>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php   }  ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                <?php   }
                                                                                                                                ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                            </tr>
                                                                                                                        <?php } ?>
                                                                                                                        <?php
                                                                                                                        // _6
                                                                                                                        // _7
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_detail_capex_7');
                                                                                                                        $this->db->where('tbl_detail_capex_7.id_detail_capex_6', $id_detail_capex_6);
                                                                                                                        $this->db->order_by('CAST(no_urut_7_capex AS DECIMAL(10,6)) ASC');
                                                                                                                        $query_result_capex_detail_7 = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($query_result_capex_detail_7->result_array() as $value_capex_detail_7) { ?>
                                                                                                                            <?php $id_detail_capex_7 = $value_capex_detail_7['id_detail_capex_7'];  ?>
                                                                                                                            <?php $nama_uraian_capex_detail_7 = $value_capex_detail_7['nama_uraian_7_capex']; ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_7['no_urut_7_capex'] ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_7['nama_uraian_7_capex']; ?></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            </tr>
                                                                                                                            <?php
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_7);
                                                                                                                            if ($id_departemen == 4) {
                                                                                                                            } else {
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                            }
                                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                            $result_program = $this->db->get() ?>
                                                                                                                            <?php
                                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                // 
                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                }

                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                }
                                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                ?>
                                                                                                                                <tr>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                                    <?php
                                                                                                                                    // capex
                                                                                                                                    $this->db->select('*');
                                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                    $this->db->limit(1);
                                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                    <?php   } else { ?>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php   }  ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                    <?php   }
                                                                                                                                    ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                                </tr>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } ?>
                                                                                                                <?php } ?>
                                                                                                            <?php } ?>
                                                                                                        <?php } ?>
                                                                                                    <?php } ?>
                                                                                                <?php } ?>
                                                                                            <?php } ?>
                                                                                        <?php } ?>


                                                                                        <?php
                                                                                        // opex
                                                                                        $this->db->select('*');
                                                                                        $this->db->from('tbl_opex');
                                                                                        $this->db->where('tbl_opex.id_kontrak', $row_kontrak['id_kontrak']);
                                                                                        $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                        $query_result_opex = $this->db->get() ?>
                                                                                        <?php
                                                                                        foreach ($query_result_opex->result_array() as $value_opex) { ?>
                                                                                            <?php $id_opex = $value_opex['id_opex'];   ?>
                                                                                            <?php $nama_uraian_opex = $value_opex['nama_uraian']; ?>
                                                                                            <tr>
                                                                                                <td class="tg-0lax"><?= $value_opex['no_urut'] ?></td>
                                                                                                <td class="tg-0lax"><?= $value_opex['nama_uraian']; ?></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                            </tr>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex);
                                                                                            if ($id_departemen == 4) {
                                                                                            } else {
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                            }
                                                                                            $result_program = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                // 
                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                }

                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                }
                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                    <?php
                                                                                                    // opex
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->limit(1);
                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                    <?php   } else { ?>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php   }  ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                    <?php   }
                                                                                                    ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                </tr>
                                                                                            <?php } ?>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_opex_detail');
                                                                                            $this->db->where('tbl_opex_detail.id_opex', $id_opex);
                                                                                            $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                            $query_result_opex_detail = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($query_result_opex_detail->result_array() as $value_opex_detail) { ?>
                                                                                                <?php $id_opex_detail = $value_opex_detail['id_opex_detail'];  ?>
                                                                                                <?php $nama_uraian_opex_detail = $value_opex_detail['nama_uraian']; ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"><?= $value_opex_detail['no_urut'] ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_opex_detail['nama_uraian']; ?></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                </tr>
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail);
                                                                                                if ($id_departemen == 4) {
                                                                                                } else {
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                }
                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                $result_program = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    // 
                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                    }

                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                    }
                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                    $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                    ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                        <?php
                                                                                                        // opex
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->limit(1);
                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                        <?php   } else { ?>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php   }  ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                        <?php   }
                                                                                                        ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                    </tr>
                                                                                                <?php } ?>
                                                                                                <!-- _1_ -->
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_detail_opex_1');
                                                                                                $this->db->where('tbl_detail_opex_1.id_opex_detail', $id_opex_detail);
                                                                                                $this->db->order_by('CAST(no_urut_1_opex AS DECIMAL(10,6)) ASC');
                                                                                                $query_result_opex_detail_1 = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($query_result_opex_detail_1->result_array() as $value_opex_detail_1) { ?>
                                                                                                    <?php $id_detail_opex_1 = $value_opex_detail_1['id_detail_opex_1'];  ?>
                                                                                                    <?php $nama_uraian_opex_detail_1 = $value_opex_detail_1['nama_uraian_1_opex']; ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"><?= $value_opex_detail_1['no_urut_1_opex'] ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_opex_detail_1['nama_uraian_1_opex']; ?></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    </tr>
                                                                                                    <?php
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail_1);
                                                                                                    if ($id_departemen == 4) {
                                                                                                    } else {
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                    }
                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                    $result_program = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        // 
                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                        }

                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                        }
                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                        $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                        ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                            <?php
                                                                                                            // opex
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->limit(1);
                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                            <?php   } else { ?>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php   }  ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                            <?php   }
                                                                                                            ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                        </tr>
                                                                                                    <?php } ?>
                                                                                                    <?php
                                                                                                    // _1
                                                                                                    // _2
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_detail_opex_2');
                                                                                                    $this->db->where('tbl_detail_opex_2.id_detail_opex_1', $id_detail_opex_1);
                                                                                                    $this->db->order_by('CAST(no_urut_2_opex AS DECIMAL(10,6)) ASC');
                                                                                                    $query_result_opex_detail_2 = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($query_result_opex_detail_2->result_array() as $value_opex_detail_2) { ?>
                                                                                                        <?php $id_detail_opex_2 = $value_opex_detail_2['id_detail_opex_2'];  ?>
                                                                                                        <?php $nama_uraian_opex_detail_2 = $value_opex_detail_2['nama_uraian_2_opex']; ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"><?= $value_opex_detail_2['no_urut_2_opex'] ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_opex_detail_2['nama_uraian_2_opex']; ?></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        </tr>
                                                                                                        <?php
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail_2);
                                                                                                        if ($id_departemen == 4) {
                                                                                                        } else {
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                        }
                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                        $result_program = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            // 
                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                            }

                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                            }
                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                            $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                            ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                <?php
                                                                                                                // opex
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->limit(1);
                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                <?php   } else { ?>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php   }  ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                <?php   }
                                                                                                                ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                            </tr>
                                                                                                        <?php } ?>
                                                                                                        <?php
                                                                                                        // _2
                                                                                                        // _3
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_detail_opex_3');
                                                                                                        $this->db->where('tbl_detail_opex_3.id_detail_opex_2', $id_detail_opex_2);
                                                                                                        $this->db->order_by('CAST(no_urut_3_opex AS DECIMAL(10,6)) ASC');
                                                                                                        $query_result_opex_detail_3 = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($query_result_opex_detail_3->result_array() as $value_opex_detail_3) { ?>
                                                                                                            <?php $id_detail_opex_3 = $value_opex_detail_3['id_detail_opex_3'];  ?>
                                                                                                            <?php $nama_uraian_opex_detail_3 = $value_opex_detail_3['nama_uraian_3_opex']; ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"><?= $value_opex_detail_3['no_urut_3_opex'] ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_opex_detail_3['nama_uraian_3_opex']; ?></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            </tr>
                                                                                                            <?php
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail_3);
                                                                                                            if ($id_departemen == 4) {
                                                                                                            } else {
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                            }
                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                            $result_program = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                // 
                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                }

                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                }
                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                    <?php
                                                                                                                    // opex
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->limit(1);
                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                    <?php   } else { ?>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php   }  ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                    <?php   }
                                                                                                                    ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                </tr>
                                                                                                            <?php } ?>

                                                                                                            <?php
                                                                                                            // _3
                                                                                                            // _4
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_detail_opex_4');
                                                                                                            $this->db->where('tbl_detail_opex_4.id_detail_opex_3', $id_detail_opex_3);
                                                                                                            $this->db->order_by('CAST(no_urut_4_opex AS DECIMAL(10,6)) ASC');
                                                                                                            $query_result_opex_detail_4 = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($query_result_opex_detail_4->result_array() as $value_opex_detail_4) { ?>
                                                                                                                <?php $id_detail_opex_4 = $value_opex_detail_4['id_detail_opex_4'];  ?>
                                                                                                                <?php $nama_uraian_opex_detail_4 = $value_opex_detail_4['nama_uraian_4_opex']; ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"><?= $value_opex_detail_4['no_urut_4_opex'] ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_opex_detail_4['nama_uraian_4_opex']; ?></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                </tr>
                                                                                                                <?php
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail_4);
                                                                                                                if ($id_departemen == 4) {
                                                                                                                } else {
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                }
                                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                $result_program = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    // 
                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                    }

                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                    }
                                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                    $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                    ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                                        <?php
                                                                                                                        // opex
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->limit(1);
                                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                        <?php   } else { ?>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php   }  ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                        <?php   }
                                                                                                                        ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                    </tr>
                                                                                                                <?php } ?>

                                                                                                                <?php
                                                                                                                // _4
                                                                                                                // _5
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_detail_opex_5');
                                                                                                                $this->db->where('tbl_detail_opex_5.id_detail_opex_4', $id_detail_opex_4);
                                                                                                                $this->db->order_by('CAST(no_urut_5_opex AS DECIMAL(10,6)) ASC');
                                                                                                                $query_result_opex_detail_5 = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($query_result_opex_detail_5->result_array() as $value_opex_detail_5) { ?>
                                                                                                                    <?php $id_detail_opex_5 = $value_opex_detail_5['id_detail_opex_5'];  ?>
                                                                                                                    <?php $nama_uraian_opex_detail_5 = $value_opex_detail_5['nama_uraian_5_opex']; ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"><?= $value_opex_detail_5['no_urut_5_opex'] ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_opex_detail_5['nama_uraian_5_opex']; ?></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    </tr>
                                                                                                                    <?php
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail_5);
                                                                                                                    if ($id_departemen == 4) {
                                                                                                                    } else {
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                    }
                                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                    $result_program = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        // 
                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                        }

                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                        }
                                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                        $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                        ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                                            <?php
                                                                                                                            // opex
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->limit(1);
                                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                            <?php   } else { ?>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php   }  ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                            <?php   }
                                                                                                                            ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                        </tr>
                                                                                                                    <?php } ?>
                                                                                                                    <?php
                                                                                                                    // _5
                                                                                                                    // _6
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_detail_opex_6');
                                                                                                                    $this->db->where('tbl_detail_opex_6.id_detail_opex_5', $id_detail_opex_5);
                                                                                                                    $this->db->order_by('CAST(no_urut_6_opex AS DECIMAL(10,6)) ASC');
                                                                                                                    $query_result_opex_detail_6 = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($query_result_opex_detail_6->result_array() as $value_opex_detail_6) { ?>
                                                                                                                        <?php $id_detail_opex_6 = $value_opex_detail_6['id_detail_opex_6'];  ?>
                                                                                                                        <?php $nama_uraian_opex_detail_6 = $value_opex_detail_6['nama_uraian_6_opex']; ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"><?= $value_opex_detail_6['no_urut_6_opex'] ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_opex_detail_6['nama_uraian_6_opex']; ?></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        </tr>
                                                                                                                        <?php
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail_6);
                                                                                                                        if ($id_departemen == 4) {
                                                                                                                        } else {
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                        }
                                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                        $result_program = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            // 
                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                            }

                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                            }
                                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                            $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                            ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                                <?php
                                                                                                                                // opex
                                                                                                                                $this->db->select('*');
                                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                $this->db->limit(1);
                                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                <?php   } else { ?>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php   }  ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                <?php   }
                                                                                                                                ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                            </tr>
                                                                                                                        <?php } ?>
                                                                                                                        <?php
                                                                                                                        // _6
                                                                                                                        // _7
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_detail_opex_7');
                                                                                                                        $this->db->where('tbl_detail_opex_7.id_detail_opex_6', $id_detail_opex_6);
                                                                                                                        $this->db->order_by('CAST(no_urut_7_opex AS DECIMAL(10,6)) ASC');
                                                                                                                        $query_result_opex_detail_7 = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($query_result_opex_detail_7->result_array() as $value_opex_detail_7) { ?>
                                                                                                                            <?php $id_detail_opex_7 = $value_opex_detail_7['id_detail_opex_7'];  ?>
                                                                                                                            <?php $nama_uraian_opex_detail_7 = $value_opex_detail_7['nama_uraian_7_opex']; ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"><?= $value_opex_detail_7['no_urut_7_opex'] ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_opex_detail_7['nama_uraian_7_opex']; ?></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            </tr>
                                                                                                                            <?php
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_opex_detail_7);
                                                                                                                            if ($id_departemen == 4) {
                                                                                                                            } else {
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                            }
                                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                            $result_program = $this->db->get() ?>
                                                                                                                            <?php
                                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                // 
                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                }

                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                }
                                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                $total_ke_atas_opex = $value_program['total_hps_mata_anggaran'];
                                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                ?>
                                                                                                                                <tr>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                                    <?php
                                                                                                                                    // opex
                                                                                                                                    $this->db->select('*');
                                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                    $this->db->limit(1);
                                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                    <?php   } else { ?>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php   }  ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                    <?php   }
                                                                                                                                    ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                                </tr>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } ?>
                                                                                                                <?php } ?>
                                                                                                            <?php } ?>
                                                                                                        <?php } ?>
                                                                                                    <?php } ?>
                                                                                                <?php } ?>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                        <?php
                                                                                        // bua
                                                                                        $this->db->select('*');
                                                                                        $this->db->from('tbl_bua');
                                                                                        $this->db->where('tbl_bua.id_kontrak', $row_kontrak['id_kontrak']);
                                                                                        $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                        $query_result_bua = $this->db->get() ?>
                                                                                        <?php
                                                                                        foreach ($query_result_bua->result_array() as $value_bua) { ?>
                                                                                            <?php $id_bua = $value_bua['id_bua'];   ?>
                                                                                            <?php $nama_uraian_bua = $value_bua['nama_uraian']; ?>
                                                                                            <tr>
                                                                                                <td class="tg-0lax"><?= $value_bua['no_urut'] ?></td>
                                                                                                <td class="tg-0lax"><?= $value_bua['nama_uraian']; ?></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                            </tr>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua);
                                                                                            if ($id_departemen == 4) {
                                                                                            } else {
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                            }
                                                                                            $result_program = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                // 
                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                }

                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                }
                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                    <?php
                                                                                                    // bua
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->limit(1);
                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                    <?php   } else { ?>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php   }  ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                    <?php   }
                                                                                                    ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                </tr>
                                                                                            <?php } ?>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_bua_detail');
                                                                                            $this->db->where('tbl_bua_detail.id_bua', $id_bua);
                                                                                            $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                            $query_result_bua_detail = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($query_result_bua_detail->result_array() as $value_bua_detail) { ?>
                                                                                                <?php $id_bua_detail = $value_bua_detail['id_bua_detail'];  ?>
                                                                                                <?php $nama_uraian_bua_detail = $value_bua_detail['nama_uraian']; ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"><?= $value_bua_detail['no_urut'] ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_bua_detail['nama_uraian']; ?></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                </tr>
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail);
                                                                                                if ($id_departemen == 4) {
                                                                                                } else {
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                }
                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                $result_program = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    // 
                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                    }

                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                    }
                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                    $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                    ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                        <?php
                                                                                                        // bua
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->limit(1);
                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                        <?php   } else { ?>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php   }  ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                        <?php   }
                                                                                                        ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                    </tr>
                                                                                                <?php } ?>
                                                                                                <!-- _1_ -->
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_detail_bua_1');
                                                                                                $this->db->where('tbl_detail_bua_1.id_bua_detail', $id_bua_detail);
                                                                                                $this->db->order_by('CAST(no_urut_1_bua AS DECIMAL(10,6)) ASC');
                                                                                                $query_result_bua_detail_1 = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($query_result_bua_detail_1->result_array() as $value_bua_detail_1) { ?>
                                                                                                    <?php $id_detail_bua_1 = $value_bua_detail_1['id_detail_bua_1'];  ?>
                                                                                                    <?php $nama_uraian_bua_detail_1 = $value_bua_detail_1['nama_uraian_1_bua']; ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"><?= $value_bua_detail_1['no_urut_1_bua'] ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_bua_detail_1['nama_uraian_1_bua']; ?></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    </tr>
                                                                                                    <?php
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail_1);
                                                                                                    if ($id_departemen == 4) {
                                                                                                    } else {
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                    }
                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                    $result_program = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        // 
                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                        }

                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                        }
                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                        $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                        ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                            <?php
                                                                                                            // bua
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->limit(1);
                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                            <?php   } else { ?>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php   }  ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                            <?php   }
                                                                                                            ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                        </tr>
                                                                                                    <?php } ?>
                                                                                                    <?php
                                                                                                    // _1
                                                                                                    // _2
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_detail_bua_2');
                                                                                                    $this->db->where('tbl_detail_bua_2.id_detail_bua_1', $id_detail_bua_1);
                                                                                                    $this->db->order_by('CAST(no_urut_2_bua AS DECIMAL(10,6)) ASC');
                                                                                                    $query_result_bua_detail_2 = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($query_result_bua_detail_2->result_array() as $value_bua_detail_2) { ?>
                                                                                                        <?php $id_detail_bua_2 = $value_bua_detail_2['id_detail_bua_2'];  ?>
                                                                                                        <?php $nama_uraian_bua_detail_2 = $value_bua_detail_2['nama_uraian_2_bua']; ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"><?= $value_bua_detail_2['no_urut_2_bua'] ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_bua_detail_2['nama_uraian_2_bua']; ?></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        </tr>
                                                                                                        <?php
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail_2);
                                                                                                        if ($id_departemen == 4) {
                                                                                                        } else {
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                        }
                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                        $result_program = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            // 
                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                            }

                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                            }
                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                            $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                            ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                <?php
                                                                                                                // bua
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->limit(1);
                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                <?php   } else { ?>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php   }  ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                <?php   }
                                                                                                                ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                            </tr>
                                                                                                        <?php } ?>
                                                                                                        <?php
                                                                                                        // _2
                                                                                                        // _3
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_detail_bua_3');
                                                                                                        $this->db->where('tbl_detail_bua_3.id_detail_bua_2', $id_detail_bua_2);
                                                                                                        $this->db->order_by('CAST(no_urut_3_bua AS DECIMAL(10,6)) ASC');
                                                                                                        $query_result_bua_detail_3 = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($query_result_bua_detail_3->result_array() as $value_bua_detail_3) { ?>
                                                                                                            <?php $id_detail_bua_3 = $value_bua_detail_3['id_detail_bua_3'];  ?>
                                                                                                            <?php $nama_uraian_bua_detail_3 = $value_bua_detail_3['nama_uraian_3_bua']; ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"><?= $value_bua_detail_3['no_urut_3_bua'] ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_bua_detail_3['nama_uraian_3_bua']; ?></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            </tr>
                                                                                                            <?php
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail_3);
                                                                                                            if ($id_departemen == 4) {
                                                                                                            } else {
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                            }
                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                            $result_program = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                // 
                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                }

                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                }
                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                    <?php
                                                                                                                    // bua
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->limit(1);
                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                    <?php   } else { ?>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php   }  ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                    <?php   }
                                                                                                                    ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                </tr>
                                                                                                            <?php } ?>

                                                                                                            <?php
                                                                                                            // _3
                                                                                                            // _4
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_detail_bua_4');
                                                                                                            $this->db->where('tbl_detail_bua_4.id_detail_bua_3', $id_detail_bua_3);
                                                                                                            $this->db->order_by('CAST(no_urut_4_bua AS DECIMAL(10,6)) ASC');
                                                                                                            $query_result_bua_detail_4 = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($query_result_bua_detail_4->result_array() as $value_bua_detail_4) { ?>
                                                                                                                <?php $id_detail_bua_4 = $value_bua_detail_4['id_detail_bua_4'];  ?>
                                                                                                                <?php $nama_uraian_bua_detail_4 = $value_bua_detail_4['nama_uraian_4_bua']; ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"><?= $value_bua_detail_4['no_urut_4_bua'] ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_bua_detail_4['nama_uraian_4_bua']; ?></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                </tr>
                                                                                                                <?php
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail_4);
                                                                                                                if ($id_departemen == 4) {
                                                                                                                } else {
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                }
                                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                $result_program = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    // 
                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                    }

                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                    }
                                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                    $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                    ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                                        <?php
                                                                                                                        // bua
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->limit(1);
                                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                        <?php   } else { ?>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php   }  ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                        <?php   }
                                                                                                                        ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                    </tr>
                                                                                                                <?php } ?>

                                                                                                                <?php
                                                                                                                // _4
                                                                                                                // _5
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_detail_bua_5');
                                                                                                                $this->db->where('tbl_detail_bua_5.id_detail_bua_4', $id_detail_bua_4);
                                                                                                                $this->db->order_by('CAST(no_urut_5_bua AS DECIMAL(10,6)) ASC');
                                                                                                                $query_result_bua_detail_5 = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($query_result_bua_detail_5->result_array() as $value_bua_detail_5) { ?>
                                                                                                                    <?php $id_detail_bua_5 = $value_bua_detail_5['id_detail_bua_5'];  ?>
                                                                                                                    <?php $nama_uraian_bua_detail_5 = $value_bua_detail_5['nama_uraian_5_bua']; ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"><?= $value_bua_detail_5['no_urut_5_bua'] ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_bua_detail_5['nama_uraian_5_bua']; ?></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    </tr>
                                                                                                                    <?php
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail_5);
                                                                                                                    if ($id_departemen == 4) {
                                                                                                                    } else {
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                    }
                                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                    $result_program = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        // 
                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                        }

                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                        }
                                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                        $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                        ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                                            <?php
                                                                                                                            // bua
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->limit(1);
                                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                            <?php   } else { ?>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php   }  ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                            <?php   }
                                                                                                                            ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                        </tr>
                                                                                                                    <?php } ?>
                                                                                                                    <?php
                                                                                                                    // _5
                                                                                                                    // _6
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_detail_bua_6');
                                                                                                                    $this->db->where('tbl_detail_bua_6.id_detail_bua_5', $id_detail_bua_5);
                                                                                                                    $this->db->order_by('CAST(no_urut_6_bua AS DECIMAL(10,6)) ASC');
                                                                                                                    $query_result_bua_detail_6 = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($query_result_bua_detail_6->result_array() as $value_bua_detail_6) { ?>
                                                                                                                        <?php $id_detail_bua_6 = $value_bua_detail_6['id_detail_bua_6'];  ?>
                                                                                                                        <?php $nama_uraian_bua_detail_6 = $value_bua_detail_6['nama_uraian_6_bua']; ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"><?= $value_bua_detail_6['no_urut_6_bua'] ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_bua_detail_6['nama_uraian_6_bua']; ?></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        </tr>
                                                                                                                        <?php
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail_6);
                                                                                                                        if ($id_departemen == 4) {
                                                                                                                        } else {
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                        }
                                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                        $result_program = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            // 
                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                            }

                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                            }
                                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                            $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                            ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                                <?php
                                                                                                                                // bua
                                                                                                                                $this->db->select('*');
                                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                $this->db->limit(1);
                                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                <?php   } else { ?>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php   }  ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                <?php   }
                                                                                                                                ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                            </tr>
                                                                                                                        <?php } ?>
                                                                                                                        <?php
                                                                                                                        // _6
                                                                                                                        // _7
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_detail_bua_7');
                                                                                                                        $this->db->where('tbl_detail_bua_7.id_detail_bua_6', $id_detail_bua_6);
                                                                                                                        $this->db->order_by('CAST(no_urut_7_bua AS DECIMAL(10,6)) ASC');
                                                                                                                        $query_result_bua_detail_7 = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($query_result_bua_detail_7->result_array() as $value_bua_detail_7) { ?>
                                                                                                                            <?php $id_detail_bua_7 = $value_bua_detail_7['id_detail_bua_7'];  ?>
                                                                                                                            <?php $nama_uraian_bua_detail_7 = $value_bua_detail_7['nama_uraian_7_bua']; ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"><?= $value_bua_detail_7['no_urut_7_bua'] ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_bua_detail_7['nama_uraian_7_bua']; ?></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            </tr>
                                                                                                                            <?php
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_bua_detail_7);
                                                                                                                            if ($id_departemen == 4) {
                                                                                                                            } else {
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                            }
                                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                            $result_program = $this->db->get() ?>
                                                                                                                            <?php
                                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                // 
                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                }

                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                }
                                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                $total_ke_atas_bua = $value_program['total_hps_mata_anggaran'];
                                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                ?>
                                                                                                                                <tr>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                                    <?php
                                                                                                                                    // bua
                                                                                                                                    $this->db->select('*');
                                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                    $this->db->limit(1);
                                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                    <?php   } else { ?>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php   }  ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                    <?php   }
                                                                                                                                    ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                                </tr>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } ?>
                                                                                                                <?php } ?>
                                                                                                            <?php } ?>
                                                                                                        <?php } ?>
                                                                                                    <?php } ?>
                                                                                                <?php } ?>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                        <?php
                                                                                        // sdm
                                                                                        $this->db->select('*');
                                                                                        $this->db->from('tbl_sdm');
                                                                                        $this->db->where('tbl_sdm.id_kontrak', $row_kontrak['id_kontrak']);
                                                                                        $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                        $query_result_sdm = $this->db->get() ?>
                                                                                        <?php
                                                                                        foreach ($query_result_sdm->result_array() as $value_sdm) { ?>
                                                                                            <?php $id_sdm = $value_sdm['id_sdm'];   ?>
                                                                                            <?php $nama_uraian_sdm = $value_sdm['nama_uraian']; ?>
                                                                                            <tr>
                                                                                                <td class="tg-0lax"><?= $value_sdm['no_urut'] ?></td>
                                                                                                <td class="tg-0lax"><?= $value_sdm['nama_uraian']; ?></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                                <td class="tg-0lax"></td>
                                                                                            </tr>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm);
                                                                                            if ($id_departemen == 4) {
                                                                                            } else {
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                            }
                                                                                            $result_program = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                ?>
                                                                                                <?php
                                                                                                // 
                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                }

                                                                                                if (round($total_margin) < 2) {
                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                }
                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                    <?php
                                                                                                    // sdm
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->limit(1);
                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                    <?php
                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                    <?php } ?>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                    <?php   } else { ?>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php   }  ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    <?php } else { ?>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                        <td class="tg-0lax">0</td>
                                                                                                    <?php   }
                                                                                                    ?>
                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                </tr>
                                                                                            <?php } ?>
                                                                                            <?php
                                                                                            $this->db->select('*');
                                                                                            $this->db->from('tbl_sdm_detail');
                                                                                            $this->db->where('tbl_sdm_detail.id_sdm', $id_sdm);
                                                                                            $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                            $query_result_sdm_detail = $this->db->get() ?>
                                                                                            <?php
                                                                                            foreach ($query_result_sdm_detail->result_array() as $value_sdm_detail) { ?>
                                                                                                <?php $id_sdm_detail = $value_sdm_detail['id_sdm_detail'];  ?>
                                                                                                <?php $nama_uraian_sdm_detail = $value_sdm_detail['nama_uraian']; ?>
                                                                                                <tr>
                                                                                                    <td class="tg-0lax"><?= $value_sdm_detail['no_urut'] ?></td>
                                                                                                    <td class="tg-0lax"><?= $value_sdm_detail['nama_uraian']; ?></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                    <td class="tg-0lax"></td>
                                                                                                </tr>
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail);
                                                                                                if ($id_departemen == 4) {
                                                                                                } else {
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                }
                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                $result_program = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                    ?>
                                                                                                    <?php
                                                                                                    // 
                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                    }

                                                                                                    if (round($total_margin) < 2) {
                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                    }
                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                    $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                    ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                        <?php
                                                                                                        // sdm
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->limit(1);
                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                        <?php
                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                        <?php } ?>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                        <?php   } else { ?>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php   }  ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        <?php } else { ?>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                            <td class="tg-0lax">0</td>
                                                                                                        <?php   }
                                                                                                        ?>
                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                    </tr>
                                                                                                <?php } ?>
                                                                                                <!-- _1_ -->
                                                                                                <?php
                                                                                                $this->db->select('*');
                                                                                                $this->db->from('tbl_detail_sdm_1');
                                                                                                $this->db->where('tbl_detail_sdm_1.id_sdm_detail', $id_sdm_detail);
                                                                                                $this->db->order_by('CAST(no_urut_1_sdm AS DECIMAL(10,6)) ASC');
                                                                                                $query_result_sdm_detail_1 = $this->db->get() ?>
                                                                                                <?php
                                                                                                foreach ($query_result_sdm_detail_1->result_array() as $value_sdm_detail_1) { ?>
                                                                                                    <?php $id_detail_sdm_1 = $value_sdm_detail_1['id_detail_sdm_1'];  ?>
                                                                                                    <?php $nama_uraian_sdm_detail_1 = $value_sdm_detail_1['nama_uraian_1_sdm']; ?>
                                                                                                    <tr>
                                                                                                        <td class="tg-0lax"><?= $value_sdm_detail_1['no_urut_1_sdm'] ?></td>
                                                                                                        <td class="tg-0lax"><?= $value_sdm_detail_1['nama_uraian_1_sdm']; ?></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                        <td class="tg-0lax"></td>
                                                                                                    </tr>
                                                                                                    <?php
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail_1);
                                                                                                    if ($id_departemen == 4) {
                                                                                                    } else {
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                    }
                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                    $result_program = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                        ?>
                                                                                                        <?php
                                                                                                        // 
                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                        }

                                                                                                        if (round($total_margin) < 2) {
                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                        }
                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                        $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                        ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                            <?php
                                                                                                            // sdm
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->limit(1);
                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                            <?php
                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                            <?php } ?>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                            <?php   } else { ?>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php   }  ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            <?php } else { ?>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                <td class="tg-0lax">0</td>
                                                                                                            <?php   }
                                                                                                            ?>
                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                        </tr>
                                                                                                    <?php } ?>
                                                                                                    <?php
                                                                                                    // _1
                                                                                                    // _2
                                                                                                    $this->db->select('*');
                                                                                                    $this->db->from('tbl_detail_sdm_2');
                                                                                                    $this->db->where('tbl_detail_sdm_2.id_detail_sdm_1', $id_detail_sdm_1);
                                                                                                    $this->db->order_by('CAST(no_urut_2_sdm AS DECIMAL(10,6)) ASC');
                                                                                                    $query_result_sdm_detail_2 = $this->db->get() ?>
                                                                                                    <?php
                                                                                                    foreach ($query_result_sdm_detail_2->result_array() as $value_sdm_detail_2) { ?>
                                                                                                        <?php $id_detail_sdm_2 = $value_sdm_detail_2['id_detail_sdm_2'];  ?>
                                                                                                        <?php $nama_uraian_sdm_detail_2 = $value_sdm_detail_2['nama_uraian_2_sdm']; ?>
                                                                                                        <tr>
                                                                                                            <td class="tg-0lax"><?= $value_sdm_detail_2['no_urut_2_sdm'] ?></td>
                                                                                                            <td class="tg-0lax"><?= $value_sdm_detail_2['nama_uraian_2_sdm']; ?></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                            <td class="tg-0lax"></td>
                                                                                                        </tr>
                                                                                                        <?php
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail_2);
                                                                                                        if ($id_departemen == 4) {
                                                                                                        } else {
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                        }
                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                        $result_program = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                            ?>
                                                                                                            <?php
                                                                                                            // 
                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                            }

                                                                                                            if (round($total_margin) < 2) {
                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                            }
                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                            $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                            ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                <?php
                                                                                                                // sdm
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->limit(1);
                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                <?php
                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                <?php } ?>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                <?php   } else { ?>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php   }  ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                <?php } else { ?>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                <?php   }
                                                                                                                ?>
                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                            </tr>
                                                                                                        <?php } ?>
                                                                                                        <?php
                                                                                                        // _2
                                                                                                        // _3
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_detail_sdm_3');
                                                                                                        $this->db->where('tbl_detail_sdm_3.id_detail_sdm_2', $id_detail_sdm_2);
                                                                                                        $this->db->order_by('CAST(no_urut_3_sdm AS DECIMAL(10,6)) ASC');
                                                                                                        $query_result_sdm_detail_3 = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($query_result_sdm_detail_3->result_array() as $value_sdm_detail_3) { ?>
                                                                                                            <?php $id_detail_sdm_3 = $value_sdm_detail_3['id_detail_sdm_3'];  ?>
                                                                                                            <?php $nama_uraian_sdm_detail_3 = $value_sdm_detail_3['nama_uraian_3_sdm']; ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"><?= $value_sdm_detail_3['no_urut_3_sdm'] ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_sdm_detail_3['nama_uraian_3_sdm']; ?></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            </tr>
                                                                                                            <?php
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail_3);
                                                                                                            if ($id_departemen == 4) {
                                                                                                            } else {
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                            }
                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                            $result_program = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                // 
                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                }

                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                }
                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                    <?php
                                                                                                                    // sdm
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->limit(1);
                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                    <?php   } else { ?>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php   }  ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                    <?php   }
                                                                                                                    ?>
                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                </tr>
                                                                                                            <?php } ?>

                                                                                                            <?php
                                                                                                            // _3
                                                                                                            // _4
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_detail_sdm_4');
                                                                                                            $this->db->where('tbl_detail_sdm_4.id_detail_sdm_3', $id_detail_sdm_3);
                                                                                                            $this->db->order_by('CAST(no_urut_4_sdm AS DECIMAL(10,6)) ASC');
                                                                                                            $query_result_sdm_detail_4 = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($query_result_sdm_detail_4->result_array() as $value_sdm_detail_4) { ?>
                                                                                                                <?php $id_detail_sdm_4 = $value_sdm_detail_4['id_detail_sdm_4'];  ?>
                                                                                                                <?php $nama_uraian_sdm_detail_4 = $value_sdm_detail_4['nama_uraian_4_sdm']; ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"><?= $value_sdm_detail_4['no_urut_4_sdm'] ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_sdm_detail_4['nama_uraian_4_sdm']; ?></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                </tr>
                                                                                                                <?php
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail_4);
                                                                                                                if ($id_departemen == 4) {
                                                                                                                } else {
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                }
                                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                $result_program = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    // 
                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                    }

                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                    }
                                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                    $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                    ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                                        <?php
                                                                                                                        // sdm
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->limit(1);
                                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                        <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                        <?php   } else { ?>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php   }  ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                        <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                        <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                            <td class="tg-0lax">0</td>
                                                                                                                        <?php   }
                                                                                                                        ?>
                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                        <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                    </tr>
                                                                                                                <?php } ?>

                                                                                                                <?php
                                                                                                                // _4
                                                                                                                // _5
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_detail_sdm_5');
                                                                                                                $this->db->where('tbl_detail_sdm_5.id_detail_sdm_4', $id_detail_sdm_4);
                                                                                                                $this->db->order_by('CAST(no_urut_5_sdm AS DECIMAL(10,6)) ASC');
                                                                                                                $query_result_sdm_detail_5 = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($query_result_sdm_detail_5->result_array() as $value_sdm_detail_5) { ?>
                                                                                                                    <?php $id_detail_sdm_5 = $value_sdm_detail_5['id_detail_sdm_5'];  ?>
                                                                                                                    <?php $nama_uraian_sdm_detail_5 = $value_sdm_detail_5['nama_uraian_5_sdm']; ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"><?= $value_sdm_detail_5['no_urut_5_sdm'] ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_sdm_detail_5['nama_uraian_5_sdm']; ?></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    </tr>
                                                                                                                    <?php
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail_5);
                                                                                                                    if ($id_departemen == 4) {
                                                                                                                    } else {
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                    }
                                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                    $result_program = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        // 
                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                        }

                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                        }
                                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                        $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                        ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                                            <?php
                                                                                                                            // sdm
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->limit(1);
                                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                            <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                            <?php   } else { ?>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php   }  ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                            <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                            <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                                <td class="tg-0lax">0</td>
                                                                                                                            <?php   }
                                                                                                                            ?>
                                                                                                                            <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                            <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                        </tr>
                                                                                                                    <?php } ?>
                                                                                                                    <?php
                                                                                                                    // _5
                                                                                                                    // _6
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_detail_sdm_6');
                                                                                                                    $this->db->where('tbl_detail_sdm_6.id_detail_sdm_5', $id_detail_sdm_5);
                                                                                                                    $this->db->order_by('CAST(no_urut_6_sdm AS DECIMAL(10,6)) ASC');
                                                                                                                    $query_result_sdm_detail_6 = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($query_result_sdm_detail_6->result_array() as $value_sdm_detail_6) { ?>
                                                                                                                        <?php $id_detail_sdm_6 = $value_sdm_detail_6['id_detail_sdm_6'];  ?>
                                                                                                                        <?php $nama_uraian_sdm_detail_6 = $value_sdm_detail_6['nama_uraian_6_sdm']; ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"><?= $value_sdm_detail_6['no_urut_6_sdm'] ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_sdm_detail_6['nama_uraian_6_sdm']; ?></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        </tr>
                                                                                                                        <?php
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail_6);
                                                                                                                        if ($id_departemen == 4) {
                                                                                                                        } else {
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                        }
                                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                        $result_program = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            // 
                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                            }

                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                            }
                                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                            $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                            ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                                <?php
                                                                                                                                // sdm
                                                                                                                                $this->db->select('*');
                                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                $this->db->limit(1);
                                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                <?php   } else { ?>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php   }  ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                    <td class="tg-0lax">0</td>
                                                                                                                                <?php   }
                                                                                                                                ?>
                                                                                                                                <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                            </tr>
                                                                                                                        <?php } ?>
                                                                                                                        <?php
                                                                                                                        // _6
                                                                                                                        // _7
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_detail_sdm_7');
                                                                                                                        $this->db->where('tbl_detail_sdm_7.id_detail_sdm_6', $id_detail_sdm_6);
                                                                                                                        $this->db->order_by('CAST(no_urut_7_sdm AS DECIMAL(10,6)) ASC');
                                                                                                                        $query_result_sdm_detail_7 = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($query_result_sdm_detail_7->result_array() as $value_sdm_detail_7) { ?>
                                                                                                                            <?php $id_detail_sdm_7 = $value_sdm_detail_7['id_detail_sdm_7'];  ?>
                                                                                                                            <?php $nama_uraian_sdm_detail_7 = $value_sdm_detail_7['nama_uraian_7_sdm']; ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"><?= $value_sdm_detail_7['no_urut_7_sdm'] ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_sdm_detail_7['nama_uraian_7_sdm']; ?></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            </tr>
                                                                                                                            <?php
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_sdm_detail_7);
                                                                                                                            if ($id_departemen == 4) {
                                                                                                                            } else {
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                            }
                                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                            $result_program = $this->db->get() ?>
                                                                                                                            <?php
                                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                // 
                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                }

                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                }
                                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                $total_ke_atas_sdm = $value_program['total_hps_mata_anggaran'];
                                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                ?>
                                                                                                                                <tr>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                                    <?php
                                                                                                                                    // sdm
                                                                                                                                    $this->db->select('*');
                                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                    $this->db->limit(1);
                                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['no_kontrak_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['tanggal_kontrak_program']; ?></td>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_hps'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['persen_progres_fisik'], 2, ',', '.') ?></td>
                                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                                    <?php   } else { ?>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php   }  ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_relasi_beban, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"><?= number_format($total_margin, 2);  ?>%</td>
                                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 1) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_jmtm, 2, ',', '.') ?> </td>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($fee_owner, 2, ',', '.') ?></td>
                                                                                                                                    <?php } else if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                                        <td class="tg-0lax"><?= "Rp " . number_format($total_efisiensi * 100  / 100, 2, ',', '.'); ?> </td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                        <td class="tg-0lax">0</td>
                                                                                                                                    <?php   }
                                                                                                                                    ?>
                                                                                                                                    <td class="tg-0lax"><?= "Rp " . number_format($prognoa_beban_tahunan, 2, ',', '.') ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                                </tr>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } ?>
                                                                                                                <?php } ?>
                                                                                                            <?php } ?>
                                                                                                        <?php } ?>
                                                                                                    <?php } ?>
                                                                                                <?php } ?>
                                                                                            <?php } ?>
                                                                                        <?php } ?>
                                                                                    </tbody>
                                                                                </table>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <!-- LAPORAN KINERJA ACTION -->
                                                                <div class="tab-pane fade show" id="custom-tabs-two-januari" role="tabpanel" aria-labelledby="custom-tabs-two-januari-tab">
                                                                    <div class="card card-outline card-primary">
                                                                        <div class="card-header">
                                                                            <h3 class="card-title">
                                                                                Action View
                                                                            </h3>
                                                                        </div>
                                                                        <br>
                                                                        <div class="card-body">
                                                                            <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                                                                                <li class="nav-item">
                                                                                    <a class="nav-link active" id="custom-tabs-master_data-tab" data-toggle="pill" href="#custom-tabs-master_data" role="tab" aria-controls="custom-tabs-master_data" aria-selected="true"><i class="fa fa-filter" aria-hidden="true"></i> Master Data</a>
                                                                                </li>
                                                                                <li class="nav-item">
                                                                                    <a class="nav-link" id="custom-tabs-history_bulanan-tab" data-toggle="pill" href="#custom-tabs-history_bulanan" role="tab" aria-controls="custom-tabs-history_bulanan" aria-selected="false"><i class="fa fa-calendar" aria-hidden="true"></i> History Penyimpanan Bulanan</a>
                                                                                </li>
                                                                            </ul>
                                                                            <div class="tab-content" id="custom-tabs-two-tabContent">

                                                                                <div class="tab-pane fade show active" id="custom-tabs-master_data" role="tabpanel" aria-labelledby="custom-tabs-master_data-tab">
                                                                                    <br>
                                                                                   
                                                                                    <div class="card card-outline card-primary">
                                                                                        <div class="card-header">
                                                                                            <h3>Master Data</h3>
                                                                                        </div>
                                                                                        <br>
                                                                                        <a href="javascript:;" style="width: 200px;" onclick="LihatFormula()" class="btn-sm btn btn-info mb-3 ml-3"><i class="fa fa-file" aria-hidden="true"></i> Rule Formula</a>
                                                                                        <div style="overflow-x: auto;">
                                                                                            <div class="card-body">
                                                                                                <table class="table tg mt-3 div1">
                                                                                                    <colgroup>
                                                                                                        <col style="width: 32px">
                                                                                                        <col style="width: 64px">
                                                                                                        <col style="width: 138px">
                                                                                                        <col style="width: 245px">
                                                                                                        <col style="width: 200px">
                                                                                                        <col style="width: 246px">
                                                                                                        <col style="width: 208px">
                                                                                                        <col style="width: 238px">
                                                                                                    </colgroup>
                                                                                                    <thead>
                                                                                                        <tr>
                                                                                                            <th class="tg-baqh" rowspan="2">No</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Uaraian</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Nama Pekerjaan</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Nama Penyedia</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Nilai Km</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Nilai Kontrak Penyedia Jasa Terupdate</th>
                                                                                                            <!-- yang di nput user  -->
                                                                                                            <th class="tg-baqh" rowspan="2">Prognosa Pendapatan</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Prognosa Beban</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Progres Fisik</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Keterangan</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Formula Fee</th>
                                                                                                            <th class="tg-baqh" rowspan="2">Aksi</th>
                                                                                                    </thead>
                                                                                                    <tbody>
                                                                                                        <?php
                                                                                                        // capex
                                                                                                        $this->db->select('*');
                                                                                                        $this->db->from('tbl_capex');
                                                                                                        $this->db->where('tbl_capex.id_kontrak', $row_kontrak['id_kontrak']);
                                                                                                        $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                                        $query_result_capex = $this->db->get() ?>
                                                                                                        <?php
                                                                                                        foreach ($query_result_capex->result_array() as $value_capex) { ?>
                                                                                                            <?php $id_capex = $value_capex['id_capex'];   ?>
                                                                                                            <?php $nama_uraian_capex = $value_capex['nama_uraian']; ?>
                                                                                                            <tr>
                                                                                                                <td class="tg-0lax"><?= $value_capex['no_urut'] ?></td>
                                                                                                                <td class="tg-0lax"><?= $value_capex['nama_uraian']; ?></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                                <td class="tg-0lax"></td>
                                                                                                            </tr>
                                                                                                            <?php
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex);
                                                                                                            if ($id_departemen == 4) {
                                                                                                            } else {
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                            }
                                                                                                            $result_program = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                ?>
                                                                                                                <?php
                                                                                                                // 
                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                }

                                                                                                                if (round($total_margin) < 2) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                }
                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                    <?php
                                                                                                                    // capex
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->limit(1);
                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                    <?php
                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } else { ?>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                    <?php } ?>
                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                        <td class="tg-0l"><?= "Rp " . number_format($total_relasi_pendapatan, 2, ',', '.') ?></td>
                                                                                                                    <?php   } else { ?>
                                                                                                                        <td class="tg-0l"></td>
                                                                                                                    <?php   }  ?>
                                                                                                                    <td class="tg-0lax">
                                                                                                                        <?= "Rp " . number_format($value_program['prognosa_beban'], 2, ',', '.') ?>
                                                                                                                    </td>
                                                                                                                    <?php if ($value_program['persen_progres_fisik']) { ?>
                                                                                                                        <!-- gila2 -->
                                                                                                                        <td class="tg-0lax"><?= number_format($value_program['persen_progres_fisik'], 2) ?>%</td>
                                                                                                                        <!-- gila -->
                                                                                                                    <?php   } else { ?>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    <?php   }  ?>
                                                                                                                    <td class="tg-0lax"> <?= $value_program['keterangan_laporan'] ?></td>
                                                                                                                    <?php if ($value_program['formula_fee_jmtm'] == 2) { ?>
                                                                                                                        <td class="tg-0l">Lumpsum</td>
                                                                                                                    <?php   } else { ?>
                                                                                                                        <td class="tg-0l">Atcost</td>
                                                                                                                    <?php   }  ?>
                                                                                                                    <td class="tg-0lax">
                                                                                                                        <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                        <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                        <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                    </td>
                                                                                                                </tr>
                                                                                                            <?php } ?>
                                                                                                            <?php
                                                                                                            $this->db->select('*');
                                                                                                            $this->db->from('tbl_capex_detail');
                                                                                                            $this->db->where('tbl_capex_detail.id_capex', $id_capex);
                                                                                                            $this->db->order_by('CAST(no_urut AS DECIMAL(10,6)) ASC');
                                                                                                            $query_result_capex_detail = $this->db->get() ?>
                                                                                                            <?php
                                                                                                            foreach ($query_result_capex_detail->result_array() as $value_capex_detail) { ?>
                                                                                                                <?php $id_capex_detail = $value_capex_detail['id_capex_detail'];  ?>
                                                                                                                <?php $nama_uraian_capex_detail = $value_capex_detail['nama_uraian']; ?>
                                                                                                                <tr>
                                                                                                                    <td class="tg-0lax"><?= $value_capex_detail['no_urut'] ?></td>
                                                                                                                    <td class="tg-0lax"><?= $value_capex_detail['nama_uraian']; ?></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                </tr>
                                                                                                                <?php
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail);
                                                                                                                if ($id_departemen == 4) {
                                                                                                                } else {
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                }
                                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                $result_program = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                    ?>
                                                                                                                    <?php
                                                                                                                    // 
                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                    }

                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                    }
                                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                    $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                    ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                                        <?php
                                                                                                                        // capex
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->limit(1);
                                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                        <?php
                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } else { ?>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                        <?php } ?>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax">
                                                                                                                            <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                            <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                            <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                <?php } ?>
                                                                                                                <!-- _1_ -->
                                                                                                                <?php
                                                                                                                $this->db->select('*');
                                                                                                                $this->db->from('tbl_detail_capex_1');
                                                                                                                $this->db->where('tbl_detail_capex_1.id_capex_detail', $id_capex_detail);
                                                                                                                $this->db->order_by('CAST(no_urut_1_capex AS DECIMAL(10,6)) ASC');
                                                                                                                $query_result_capex_detail_1 = $this->db->get() ?>
                                                                                                                <?php
                                                                                                                foreach ($query_result_capex_detail_1->result_array() as $value_capex_detail_1) { ?>
                                                                                                                    <?php $id_detail_capex_1 = $value_capex_detail_1['id_detail_capex_1'];  ?>
                                                                                                                    <?php $nama_uraian_capex_detail_1 = $value_capex_detail_1['nama_uraian_1_capex']; ?>
                                                                                                                    <tr>
                                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_1['no_urut_1_capex'] ?></td>
                                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_1['nama_uraian_1_capex']; ?></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                    </tr>
                                                                                                                    <?php
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_1);
                                                                                                                    if ($id_departemen == 4) {
                                                                                                                    } else {
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                    }
                                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                    $result_program = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                        ?>
                                                                                                                        <?php
                                                                                                                        // 
                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                        }

                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                        }
                                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                        $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                        ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                                            <?php
                                                                                                                            // capex
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->limit(1);
                                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                            <?php
                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } else { ?>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                            <?php } ?>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax">
                                                                                                                                <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                                <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                                <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                            </td>
                                                                                                                        </tr>
                                                                                                                    <?php } ?>
                                                                                                                    <?php
                                                                                                                    // _1
                                                                                                                    // _2
                                                                                                                    $this->db->select('*');
                                                                                                                    $this->db->from('tbl_detail_capex_2');
                                                                                                                    $this->db->where('tbl_detail_capex_2.id_detail_capex_1', $id_detail_capex_1);
                                                                                                                    $this->db->order_by('CAST(no_urut_2_capex AS DECIMAL(10,6)) ASC');
                                                                                                                    $query_result_capex_detail_2 = $this->db->get() ?>
                                                                                                                    <?php
                                                                                                                    foreach ($query_result_capex_detail_2->result_array() as $value_capex_detail_2) { ?>
                                                                                                                        <?php $id_detail_capex_2 = $value_capex_detail_2['id_detail_capex_2'];  ?>
                                                                                                                        <?php $nama_uraian_capex_detail_2 = $value_capex_detail_2['nama_uraian_2_capex']; ?>
                                                                                                                        <tr>
                                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_2['no_urut_2_capex'] ?></td>
                                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_2['nama_uraian_2_capex']; ?></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                        </tr>
                                                                                                                        <?php
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_2);
                                                                                                                        if ($id_departemen == 4) {
                                                                                                                        } else {
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                        }
                                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                        $result_program = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                            ?>
                                                                                                                            <?php
                                                                                                                            // 
                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                            }

                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                            }
                                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                            $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                            ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                                <?php
                                                                                                                                // capex
                                                                                                                                $this->db->select('*');
                                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                $this->db->limit(1);
                                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                <?php
                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } else { ?>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                <?php } ?>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax">
                                                                                                                                    <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                                    <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                                    <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                                </td>
                                                                                                                            </tr>
                                                                                                                        <?php } ?>
                                                                                                                        <?php
                                                                                                                        // _2
                                                                                                                        // _3
                                                                                                                        $this->db->select('*');
                                                                                                                        $this->db->from('tbl_detail_capex_3');
                                                                                                                        $this->db->where('tbl_detail_capex_3.id_detail_capex_2', $id_detail_capex_2);
                                                                                                                        $this->db->order_by('CAST(no_urut_3_capex AS DECIMAL(10,6)) ASC');
                                                                                                                        $query_result_capex_detail_3 = $this->db->get() ?>
                                                                                                                        <?php
                                                                                                                        foreach ($query_result_capex_detail_3->result_array() as $value_capex_detail_3) { ?>
                                                                                                                            <?php $id_detail_capex_3 = $value_capex_detail_3['id_detail_capex_3'];  ?>
                                                                                                                            <?php $nama_uraian_capex_detail_3 = $value_capex_detail_3['nama_uraian_3_capex']; ?>
                                                                                                                            <tr>
                                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_3['no_urut_3_capex'] ?></td>
                                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_3['nama_uraian_3_capex']; ?></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                            </tr>
                                                                                                                            <?php
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_3);
                                                                                                                            if ($id_departemen == 4) {
                                                                                                                            } else {
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                            }
                                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                            $result_program = $this->db->get() ?>
                                                                                                                            <?php
                                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                ?>
                                                                                                                                <?php
                                                                                                                                // 
                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                }

                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                }
                                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                ?>
                                                                                                                                <tr>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                                    <?php
                                                                                                                                    // capex
                                                                                                                                    $this->db->select('*');
                                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                    $this->db->limit(1);
                                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                    <?php
                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } else { ?>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                    <?php } ?>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax">
                                                                                                                                        <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                                        <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                                        <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                                    </td>
                                                                                                                                </tr>
                                                                                                                            <?php } ?>

                                                                                                                            <?php
                                                                                                                            // _3
                                                                                                                            // _4
                                                                                                                            $this->db->select('*');
                                                                                                                            $this->db->from('tbl_detail_capex_4');
                                                                                                                            $this->db->where('tbl_detail_capex_4.id_detail_capex_3', $id_detail_capex_3);
                                                                                                                            $this->db->order_by('CAST(no_urut_4_capex AS DECIMAL(10,6)) ASC');
                                                                                                                            $query_result_capex_detail_4 = $this->db->get() ?>
                                                                                                                            <?php
                                                                                                                            foreach ($query_result_capex_detail_4->result_array() as $value_capex_detail_4) { ?>
                                                                                                                                <?php $id_detail_capex_4 = $value_capex_detail_4['id_detail_capex_4'];  ?>
                                                                                                                                <?php $nama_uraian_capex_detail_4 = $value_capex_detail_4['nama_uraian_4_capex']; ?>
                                                                                                                                <tr>
                                                                                                                                    <td class="tg-0lax"><?= $value_capex_detail_4['no_urut_4_capex'] ?></td>
                                                                                                                                    <td class="tg-0lax"><?= $value_capex_detail_4['nama_uraian_4_capex']; ?></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                </tr>
                                                                                                                                <?php
                                                                                                                                $this->db->select('*');
                                                                                                                                $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                                $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                                $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_4);
                                                                                                                                if ($id_departemen == 4) {
                                                                                                                                } else {
                                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                    $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                                }
                                                                                                                                $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                                $result_program = $this->db->get() ?>
                                                                                                                                <?php
                                                                                                                                foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                    <?php
                                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                    $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                    ?>
                                                                                                                                    <?php
                                                                                                                                    $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                    ?>
                                                                                                                                    <?php
                                                                                                                                    $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                    $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                    ?>
                                                                                                                                    <?php
                                                                                                                                    // 
                                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                                        $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                        $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                        $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                                        $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                    }

                                                                                                                                    if (round($total_margin) < 2) {
                                                                                                                                        $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                    } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                        $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                    } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                        $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                    } else if (round($total_margin) >= 8) {
                                                                                                                                        $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                    }
                                                                                                                                    $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                    $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                    $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                                    $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                    ?>
                                                                                                                                    <tr>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                        <!-- ambil kontrak awal / addendum -->
                                                                                                                                        <?php
                                                                                                                                        // capex
                                                                                                                                        $this->db->select('*');
                                                                                                                                        $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                        $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                        $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                        $this->db->limit(1);
                                                                                                                                        $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                        <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                        <?php
                                                                                                                                        if ($get_addendum_kontrak) { ?>
                                                                                                                                            <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                            <?php } ?>
                                                                                                                                        <?php } else { ?>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                        <?php } ?>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax">
                                                                                                                                            <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                                            <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                                            <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                                        </td>
                                                                                                                                    </tr>
                                                                                                                                <?php } ?>

                                                                                                                                <?php
                                                                                                                                // _4
                                                                                                                                // _5
                                                                                                                                $this->db->select('*');
                                                                                                                                $this->db->from('tbl_detail_capex_5');
                                                                                                                                $this->db->where('tbl_detail_capex_5.id_detail_capex_4', $id_detail_capex_4);
                                                                                                                                $this->db->order_by('CAST(no_urut_5_capex AS DECIMAL(10,6)) ASC');
                                                                                                                                $query_result_capex_detail_5 = $this->db->get() ?>
                                                                                                                                <?php
                                                                                                                                foreach ($query_result_capex_detail_5->result_array() as $value_capex_detail_5) { ?>
                                                                                                                                    <?php $id_detail_capex_5 = $value_capex_detail_5['id_detail_capex_5'];  ?>
                                                                                                                                    <?php $nama_uraian_capex_detail_5 = $value_capex_detail_5['nama_uraian_5_capex']; ?>
                                                                                                                                    <tr>
                                                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_5['no_urut_5_capex'] ?></td>
                                                                                                                                        <td class="tg-0lax"><?= $value_capex_detail_5['nama_uraian_5_capex']; ?></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                        <td class="tg-0lax"></td>
                                                                                                                                    </tr>
                                                                                                                                    <?php
                                                                                                                                    $this->db->select('*');
                                                                                                                                    $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                                    $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                                    $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_5);
                                                                                                                                    if ($id_departemen == 4) {
                                                                                                                                    } else {
                                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                        $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                                    }
                                                                                                                                    $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                    $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                                    $result_program = $this->db->get() ?>
                                                                                                                                    <?php
                                                                                                                                    foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                        <?php
                                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                        $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                        ?>
                                                                                                                                        <?php
                                                                                                                                        $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                        ?>
                                                                                                                                        <?php
                                                                                                                                        $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                        $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                        ?>
                                                                                                                                        <?php
                                                                                                                                        // 
                                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                                            $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                            $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                            $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                                            $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                        }

                                                                                                                                        if (round($total_margin) < 2) {
                                                                                                                                            $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                        } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                            $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                        } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                            $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                        } else if (round($total_margin) >= 8) {
                                                                                                                                            $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                        }
                                                                                                                                        $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                        $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                        $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                                        $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                        ?>
                                                                                                                                        <tr>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                            <!-- ambil kontrak awal / addendum -->
                                                                                                                                            <?php
                                                                                                                                            // capex
                                                                                                                                            $this->db->select('*');
                                                                                                                                            $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                            $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                            $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                            $this->db->limit(1);
                                                                                                                                            $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                            <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                            <?php
                                                                                                                                            if ($get_addendum_kontrak) { ?>
                                                                                                                                                <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                                <?php } ?>
                                                                                                                                            <?php } else { ?>
                                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                            <?php } ?>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax">
                                                                                                                                                <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                                                <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                                                <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                                            </td>
                                                                                                                                        </tr>
                                                                                                                                    <?php } ?>
                                                                                                                                    <?php
                                                                                                                                    // _5
                                                                                                                                    // _6
                                                                                                                                    $this->db->select('*');
                                                                                                                                    $this->db->from('tbl_detail_capex_6');
                                                                                                                                    $this->db->where('tbl_detail_capex_6.id_detail_capex_5', $id_detail_capex_5);
                                                                                                                                    $this->db->order_by('CAST(no_urut_6_capex AS DECIMAL(10,6)) ASC');
                                                                                                                                    $query_result_capex_detail_6 = $this->db->get() ?>
                                                                                                                                    <?php
                                                                                                                                    foreach ($query_result_capex_detail_6->result_array() as $value_capex_detail_6) { ?>
                                                                                                                                        <?php $id_detail_capex_6 = $value_capex_detail_6['id_detail_capex_6'];  ?>
                                                                                                                                        <?php $nama_uraian_capex_detail_6 = $value_capex_detail_6['nama_uraian_6_capex']; ?>
                                                                                                                                        <tr>
                                                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_6['no_urut_6_capex'] ?></td>
                                                                                                                                            <td class="tg-0lax"><?= $value_capex_detail_6['nama_uraian_6_capex']; ?></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                            <td class="tg-0lax"></td>
                                                                                                                                        </tr>
                                                                                                                                        <?php
                                                                                                                                        $this->db->select('*');
                                                                                                                                        $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                                        $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                                        $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_6);
                                                                                                                                        if ($id_departemen == 4) {
                                                                                                                                        } else {
                                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                            $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                                        }
                                                                                                                                        $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                        $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                                        $result_program = $this->db->get() ?>
                                                                                                                                        <?php
                                                                                                                                        foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                            <?php
                                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                            $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                            ?>
                                                                                                                                            <?php
                                                                                                                                            $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                            ?>
                                                                                                                                            <?php
                                                                                                                                            $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                            $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                            ?>
                                                                                                                                            <?php
                                                                                                                                            // 
                                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                                $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                                $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                                $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                                $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                            }

                                                                                                                                            if (round($total_margin) < 2) {
                                                                                                                                                $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                            } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                                $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                            } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                                $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                            } else if (round($total_margin) >= 8) {
                                                                                                                                                $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                            }
                                                                                                                                            $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                            $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                            $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                                            $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                            ?>
                                                                                                                                            <tr>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                                <!-- ambil kontrak awal / addendum -->
                                                                                                                                                <?php
                                                                                                                                                // capex
                                                                                                                                                $this->db->select('*');
                                                                                                                                                $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                                $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                                $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                                $this->db->limit(1);
                                                                                                                                                $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                                <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                                <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                                <?php
                                                                                                                                                if ($get_addendum_kontrak) { ?>
                                                                                                                                                    <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                                    <?php } ?>
                                                                                                                                                <?php } else { ?>
                                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                                <?php } ?>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax">
                                                                                                                                                    <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                                                    <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                                                    <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                                                </td>
                                                                                                                                            </tr>
                                                                                                                                        <?php } ?>
                                                                                                                                        <?php
                                                                                                                                        // _6
                                                                                                                                        // _7
                                                                                                                                        $this->db->select('*');
                                                                                                                                        $this->db->from('tbl_detail_capex_7');
                                                                                                                                        $this->db->where('tbl_detail_capex_7.id_detail_capex_6', $id_detail_capex_6);
                                                                                                                                        $this->db->order_by('CAST(no_urut_7_capex AS DECIMAL(10,6)) ASC');
                                                                                                                                        $query_result_capex_detail_7 = $this->db->get() ?>
                                                                                                                                        <?php
                                                                                                                                        foreach ($query_result_capex_detail_7->result_array() as $value_capex_detail_7) { ?>
                                                                                                                                            <?php $id_detail_capex_7 = $value_capex_detail_7['id_detail_capex_7'];  ?>
                                                                                                                                            <?php $nama_uraian_capex_detail_7 = $value_capex_detail_7['nama_uraian_7_capex']; ?>
                                                                                                                                            <tr>
                                                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_7['no_urut_7_capex'] ?></td>
                                                                                                                                                <td class="tg-0lax"><?= $value_capex_detail_7['nama_uraian_7_capex']; ?></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                                <td class="tg-0lax"></td>
                                                                                                                                            </tr>
                                                                                                                                            <?php
                                                                                                                                            $this->db->select('*');
                                                                                                                                            $this->db->from('tbl_sub_detail_program_penyedia_jasa');
                                                                                                                                            $this->db->join('tbl_detail_program_penyedia_jasa', 'tbl_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa = tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'left');
                                                                                                                                            $this->db->where('tbl_sub_detail_program_penyedia_jasa.nama_program_mata_anggaran', $nama_uraian_capex_detail_7);
                                                                                                                                            if ($id_departemen == 4) {
                                                                                                                                            } else {
                                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_departemen', $row_kontrak['id_departemen']);
                                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_area', $row_kontrak['id_area']);
                                                                                                                                                $this->db->where('tbl_detail_program_penyedia_jasa.id_sub_area', $row_kontrak['id_sub_area']);
                                                                                                                                            }
                                                                                                                                            $this->db->order_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                            $this->db->group_by('tbl_sub_detail_program_penyedia_jasa.id_detail_program_penyedia_jasa');
                                                                                                                                            $result_program = $this->db->get() ?>
                                                                                                                                            <?php
                                                                                                                                            foreach ($result_program->result_array() as $value_program) { ?>
                                                                                                                                                <?php
                                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                                $total_relasi_beban = ($value_program['prognosa_beban'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                                ?>
                                                                                                                                                <?php
                                                                                                                                                $total_relasi_pendapatan  =  ($value_program['nilai_program_mata_anggran'] * $value_program['persen_progres_fisik']) / 100;
                                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                                ?>
                                                                                                                                                <?php
                                                                                                                                                $total_efisiensi =  $value_program['nilai_program_mata_anggran'] - $value_program['prognosa_beban'];
                                                                                                                                                $total_margin = ($total_efisiensi / $value_program['nilai_program_mata_anggran']) * 100;
                                                                                                                                                ?>
                                                                                                                                                <?php
                                                                                                                                                // 
                                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 0  / 100;
                                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 50  / 100;
                                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 70  / 100;
                                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                                    $fee_jmtm  =  $total_efisiensi * 90  / 100;
                                                                                                                                                }

                                                                                                                                                if (round($total_margin) < 2) {
                                                                                                                                                    $fee_owner  =  $total_efisiensi * 100  / 100;
                                                                                                                                                } else if (round($total_margin) >= 2 && round($total_margin) <= 4) {
                                                                                                                                                    $fee_owner  =  $total_efisiensi * 50  / 100;
                                                                                                                                                } else if (round($total_margin) >= 4 && round($total_margin) <= 8) {
                                                                                                                                                    $fee_owner  =  $total_efisiensi * 30 / 100;
                                                                                                                                                } else if (round($total_margin) >= 8) {
                                                                                                                                                    $fee_owner  =  $total_efisiensi * 10  / 100;
                                                                                                                                                }
                                                                                                                                                $total_kontrak_awal_vendor_atas = 0;
                                                                                                                                                $total_kontrak_awal_vendor_atas += $value_program['nilai_sub_kontrak_penyedia'];
                                                                                                                                                $total_ke_atas_capex = $value_program['total_hps_mata_anggaran'];
                                                                                                                                                $prognoa_beban_tahunan = $value_program['nilai_sub_kontrak_penyedia'] +  $fee_owner;
                                                                                                                                                ?>
                                                                                                                                                <tr>
                                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_pekerjaan_program_mata_anggaran']; ?></td>
                                                                                                                                                    <!-- ambil kontrak awal / addendum -->
                                                                                                                                                    <?php
                                                                                                                                                    // capex
                                                                                                                                                    $this->db->select('*');
                                                                                                                                                    $this->db->from('tbl_hps_penyedia_kontrak_addendum');
                                                                                                                                                    $this->db->where('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', $value_program['id_detail_program_penyedia_jasa']);
                                                                                                                                                    $this->db->order_by('tbl_hps_penyedia_kontrak_addendum.id_detail_program_penyedia_jasa', 'ASC');
                                                                                                                                                    $this->db->limit(1);
                                                                                                                                                    $get_addendum_kontrak = $this->db->get()->result_array() ?>
                                                                                                                                                    <td class="tg-0lax"><?= $value_program['nama_penyedia']; ?></td>
                                                                                                                                                    <td class="tg-0lax"> <?= "Rp " . number_format($value_program['nilai_sub_kontrak_penyedia'], 2, ',', '.') ?></td>
                                                                                                                                                    <?php
                                                                                                                                                    if ($get_addendum_kontrak) { ?>
                                                                                                                                                        <?php foreach ($get_addendum_kontrak as $value_addendum_kontrak) { ?>
                                                                                                                                                            <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak_addendum_' . $value_addendum_kontrak['no_addendum']], 2, ',', '.') ?></td>
                                                                                                                                                        <?php } ?>
                                                                                                                                                    <?php } else { ?>
                                                                                                                                                        <td class="tg-0lax"> <?= "Rp " . number_format($value_program['total_kontrak'], 2, ',', '.') ?></td>
                                                                                                                                                    <?php } ?>
                                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                                    <td class="tg-0lax"></td>
                                                                                                                                                    <td class="tg-0lax">
                                                                                                                                                        <a href="javascript:;" onclick="ProgresFisik(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-primary btn-block"><i class="fas fa fa-file"></i> Keloa Progres Fisik</a>
                                                                                                                                                        <a href="javascript:;" onclick="Keterangan(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-secondary btn-block mt-2"><i class="fas fa fa-file"></i> Buat Keterangan</a>
                                                                                                                                                        <a href="javascript:;" onclick="PilihFormula(<?= $value_program['id_detail_sub_program_penyedia_jasa'] ?>)" style="font-size: 10px;" class="btn btn-sm btn-outline-warning btn-block mt-2"><i class="fas fa fa-file"></i> Pilih Formula</a>

                                                                                                                                                    </td>
                                                                                                                                                </tr>
                                                                                                                                            <?php } ?>
                                                                                                                                        <?php } ?>
                                                                                                                                    <?php } ?>
                                                                                                                                <?php } ?>
                                                                                                                            <?php } ?>
                                                                                                                        <?php } ?>
                                                                                                                    <?php } ?>
                                                                                                                <?php } ?>
                                                                                                            <?php } ?>
                                                                                                        <?php } ?>
                                                                                                    </tbody>
                                                                                                </table>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>

                                                                                <div class="tab-pane fade show" id="custom-tabs-history_bulanan" role="tabpanel" aria-labelledby="custom-tabs-history_bulanan-tab">
                                                                                    <div class="card card-outline card-primary">
                                                                                        <div class="card-header">
                                                                                            <h3 class="card-title">
                                                                                                History Penyimpanan Bulanan
                                                                                            </h3>
                                                                                        </div>
                                                                                        <br>
                                                                                        <div class="card-body">
                                                                                            <a href="javascript:;" onclick="Buat_periode(<?= $row_kontrak['id_kontrak'] ?>)" class="btn-sm btn btn-success"><i class="fa fa-plus-circle" aria-hidden="true"></i> Buat Periode Laporan</a>
                                                                                            <a href="javascript:;" onclick="Upload_laporan(<?= $row_kontrak['id_kontrak'] ?>)" class="btn-sm btn btn-danger"><i class="fa fa-file" aria-hidden="true"></i> Upload Periode Laporan</a>

                                                                                        </div>
                                                                                    </div>
                                                                                </div>

                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- /.row -->
                                                </div>
                                                <!-- ./card-body -->
                                                <!-- /.card-footer -->
                                            </div>
                                            <!-- /.card -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- /.col -->
                        </div>
                        <!-- /.row -->
                        <!-- Main row -->
                        <!-- /.row -->
                    </div>


                    <!-- Modal -->
                    <div class="modal fade" data-backdrop="false" id="modal_buat_periode" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">Buat Peridoe</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form action="javascript:;" id="form_modal_buat_periode">
                                        <input type="hidden" name="id_kontrak" class="form-control">
                                        <div class="form-group">
                                            <label for="">Tanggal Dan Bulan Periode</label>
                                            <input type="date" name="tanggal_bulan_periode" class="form-control">
                                        </div>
                                        <div class="form-group">
                                            <label for="">Keterangan</label>
                                            <textarea class="form-control" name="keterangan_periode"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <a href="javascript:;" onclick="Simpan_Periode()" class="btn btn-success">Simpan Laporan Periode</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal -->
                    <div class="modal fade" data-backdrop="false" id="modal_progres_fisik" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">Update Progres Fisik</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <form action="javascript:;" id="form_progres_fisik" method="post">
                                            <input type="hidden" name="id_detail_sub_program_penyedia_jasa">
                                            <div class="form-group">
                                                <label for="">% Progres Fisik</label>
                                                <input type="number" name="persen_progres_fisik" id="" class="form-control" placeholder="Masukan Nilai Persen %">
                                                <br>
                                                <div style="display: none;">
                                                <label for="">Nilai Kontrak Management</label>
                                                <input type="number" name="nilai_program_mata_anggran" id="" class="form-control" placeholder="Masukan Nilai Km">
                                                <br>
                                                </div>
                                                <label for="">Nilai Prognosa Beban</label>
                                                <input type="number" name="prognosa_beban" id="" class="form-control" placeholder="Masukan Nilai Prognosa_beban">
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <a href="javascript:;" class="btn btn-outline-success" onclick="SimpanProgresFisik()">Simpan</a>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="modal fade" data-backdrop="false" id="modal_keterangan" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">Buat Keterangan</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <form action="javascript:;" id="form_keterangan" method="post">
                                            <input type="hidden" name="id_detail_sub_program_penyedia_jasa">
                                            <div class="form-group">
                                                <label for="">Isi Keterangan</label>
                                                <textarea name="keterangan_laporan" id="" class="form-control" cols="30" rows="10"></textarea>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <a href="javascript:;" class="btn btn-outline-success" onclick="SimpanKeterangan()">Simpan</a>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="modal fade" data-backdrop="false" id="modal_pilih_formula" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">Pilih Formula Fee Jmtm</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <form action="javascript:;" id="form_pilih_formula" method="post">
                                            <input type="hidden" name="id_detail_sub_program_penyedia_jasa">
                                            <div class="form-group">
                                                <label for="">Pilih Formula</label>
                                                <select name="formula_fee_jmtm" class="form-control">
                                                    <option value="">-- Pilih Formula --</option>
                                                    <option value="2">Formula Lumpsum</option>
                                                    <option value="1">Formula Atcost</option>
                                                </select>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <a href="javascript:;" class="btn btn-outline-success" onclick="Simpanpilih_formula()">Simpan</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal -->
                    <div class="modal fade" data-backdrop="false" style="z-index: 99999999;" id="modal_lihat_formula" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">RULE FORMULA</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div>
                                        <img src="<?= base_url('assets/formula.png') ?>" width="100%" alt="">
                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal -->
                    <div class="modal fade" data-backdrop="false" id="modal_upload_laporan" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="title_modal_excel">UPLOAD LAPORAN PERIODE</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <?= form_open_multipart('laporan_kinerja/upload_laporan') ?>
                                <div class="modal-body">
                                    <input type="hidden" name="id_kontrak" value="<?= $row_kontrak['id_kontrak'] ?>">
                                    <center>
                                        <label for="Divisi" style="font-weight: bold;" class="col-form-label">Upload excel</label>
                                    </center>
                                    <div class="form-group">
                                        <label for="">File</label>
                                        <input type="file" class="form-control form-control-sm" accept=".xlsx,.xls" name="file_excel_laporan">
                                    </div>

                                    <div class="form-group">
                                        <label for="">Tanggal & Bulan Periode Laporan</label>
                                        <input type="date" class="form-control form-control-sm" name="tanggal_laporan">
                                    </div>

                                    <div class="form-group">
                                        <label for="">Keterangan</label>
                                        <textarea name="ket_laporan" class="form-control"></textarea>
                                    </div>

                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            Result Dokumen
                                        </div>
                                        <div class="card-body">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th class="text-white">No</th>
                                                        <th class="text-white">Tanggal</th>
                                                        <th class="text-white">Download / File</th>
                                                        <th class="text-white">Keterangan</th>
                                                        <th class="text-white">Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <?php $no = 1;
                                                    foreach ($result_dokumen_laporan as $key => $value) { ?>
                                                        <tr>
                                                            <td scope="row"><?= $no++ ?></td>
                                                            <td><?= $value['tanggal_laporan'] ?></td>
                                                            <td><a class="btn btn-sm btn-success" href="<?= base_url('dokumen_excel_laporan_kinerja/') . $value['file_excel_laporan'] ?>" target="_blank"><i class="fas fa-file"></i> <?= $value['file_excel_laporan'] ?></a></td>
                                                            <td><?= $value['ket_laporan'] ?></td>
                                                            <td><a class="btn btn-sm btn-danger" href="<?= base_url('laporan_kinerja/hapus_dokumen_kinerja/') . $value['id_dokumen_laporan_kinerja'] ?>"><i class="fas fa-trash"></i> Hapus</a></td>
                                                        </tr>
                                                    <?php  } ?>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button class="btn btn-sm btn-success" type="submit"><img src="<?= base_url('assets/excel.png') ?>" style="width: 20px;" alt=""> UPLOAD</button>
                                </div>
                                <?= form_close(); ?>
                            </div>
                        </div>
                    </div>

                    <!--/. container-fluid -->
            </section>
            <!-- /.content -->
        </div>
    </section>
</div>